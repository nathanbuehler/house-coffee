<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Coffee Host | Nathan</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        color: #333;
      }
      header {
        background-color: #333;
        color: #fff;
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        flex-wrap: wrap;
        gap: 0.75rem;
      }
      .header-main {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }
      header h1 {
        margin: 0;
        font-size: 1.4rem;
      }
      header .subtitle {
        margin: 0.25rem 0 0;
        font-size: 0.9rem;
        opacity: 0.8;
      }
      .header-nav {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .header-nav a {
        font-size: 0.85rem;
        text-decoration: none;
        color: #e5e7eb;
        border: 1px solid #6b7280;
        border-radius: 999px;
        padding: 0.25rem 0.7rem;
        background-color: #111827;
      }
      .header-nav a:hover {
        background-color: #1f2937;
      }
      main {
        padding: 1rem;
        max-width: 1100px;
        margin: 0 auto;
      }
      .layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
      }
      .full-width {
        grid-column: 1 / -1;
      }
      .panel {
        background-color: #fff;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        padding: 1rem;
      }
      .panel h2 {
        margin-top: 0;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.75rem;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      .section-header h2 {
        margin: 0;
      }
      .section-header .small-note {
        font-size: 0.8rem;
        color: #666;
      }
      .section {
        margin-bottom: 1.5rem;
      }
      .section h3 {
        margin-top: 0;
        margin-bottom: 0.5rem;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
      }
      th,
      td {
        padding: 0.4rem;
        border-bottom: 1px solid #eee;
        text-align: left;
      }
      th {
        background-color: #f3f4f6;
        font-weight: 600;
      }
      tr:nth-child(even) {
        background-color: #fafafa;
      }
      button {
        font-family: inherit;
        font-size: 0.85rem;
        cursor: pointer;
      }
      .btn-primary {
        background-color: #2563eb;
        color: white;
        border: none;
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
      }
      .btn-secondary {
        background-color: #e5e7eb;
        color: #111827;
        border: 1px solid #d1d5db;
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
      }
      .btn-danger {
        background-color: #dc2626;
        color: #fff;
        border: none;
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
      }
      .btn-small {
        font-size: 0.75rem;
        padding: 0.2rem 0.4rem;
      }
      .form-row {
        margin-bottom: 0.5rem;
      }
      .form-row label {
        display: block;
        font-size: 0.8rem;
        margin-bottom: 0.2rem;
      }
      .form-row input,
      .form-row select,
      .form-row textarea {
        width: 100%;
        padding: 0.35rem;
        font-size: 0.85rem;
        border-radius: 4px;
        border: 1px solid #d1d5db;
        box-sizing: border-box;
      }
      .form-actions {
        margin-top: 0.75rem;
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }
      .status-message {
        margin-top: 0.4rem;
        font-size: 0.8rem;
        color: #6b7280;
      }
      .status-error {
        color: #b91c1c;
      }
      .status-success {
        color: #065f46;
      }
      .badge-default {
        display: inline-block;
        padding: 0.1rem 0.4rem;
        font-size: 0.7rem;
        border-radius: 999px;
        background-color: #d1fae5;
        color: #065f46;
      }
      .badge-boolean {
        display: inline-block;
        padding: 0.1rem 0.4rem;
        font-size: 0.7rem;
        border-radius: 999px;
      }
      .badge-boolean.true {
        background-color: #d1fae5;
        color: #065f46;
      }
      .badge-boolean.false {
        background-color: #fee2e2;
        color: #b91c1c;
      }
      .small-note {
        font-size: 0.8rem;
        color: #6b7280;
      }
      .orders-filters {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        margin-bottom: 0.75rem;
        flex-wrap: wrap;
      }
      .orders-filters select {
        padding: 0.35rem;
        font-size: 0.85rem;
      }
      .manual-order-form {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 0.5rem 0.75rem;
        align-items: end;
      }
      .manual-order-form .wide {
        grid-column: 1 / -1;
      }
      .manual-order-form textarea {
        min-height: 50px;
        resize: vertical;
      }
      .orders-table td {
        vertical-align: top;
      }
      .orders-table small {
        color: #718096;
      }
      .orders-table .order-meta {
        font-size: 0.75rem;
        color: #4a5568;
      }
      .orders-table .order-notes {
        font-size: 0.8rem;
        color: #2d3748;
      }
      .orders-table .order-flags {
        margin-top: 0.15rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
      }
      .orders-table .order-flags span {
        font-size: 0.7rem;
        padding: 0.05rem 0.35rem;
        border-radius: 999px;
        background: #edf2f7;
      }
      .orders-table .order-flags span.flag-iced {
        background: #bfdbfe;
        color: #1d4ed8;
      }
      .orders-table .order-flags span.flag-syrup {
        background: #fef3c7;
        color: #b45309;
      }

      /* collapsible drinks section */
      #drinks-section.collapsed #drinks-table-container,
      #drinks-section.collapsed #drink-edit-form-container {
        display: none;
      }

      @media (max-width: 900px) {
        .layout {
          grid-template-columns: 1fr;
        }
        .manual-order-form {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-main">
        <h1>Nathan's Coffee | Host View</h1>
        <p class="subtitle">
          Manage menus, drinks, syrups &amp; orders. Now with actual authentication.
        </p>
      </div>
      <nav class="header-nav">
        <a href="index.html">Guest view</a>
        <button id="logout-btn" class="btn-secondary btn-small" type="button">
          Sign out
        </button>
      </nav>
    </header>

    <main>
      <!-- LOGIN SECTION (shown when not authenticated) -->
      <section id="auth-section" class="section panel">
        <div class="section-header">
          <div>
            <h2>Host login</h2>
            <div class="small-note">
              Sign in with your Supabase email &amp; password to manage orders.
            </div>
          </div>
        </div>

        <form id="login-form">
          <div class="form-row">
            <label for="login-email">Email</label>
            <input id="login-email" type="email" required />
          </div>
          <div class="form-row">
            <label for="login-password">Password</label>
            <input id="login-password" type="password" required />
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Sign in</button>
            <span id="login-status" class="status-message"></span>
          </div>
        </form>
      </section>

      <!-- APP WRAPPER (hidden until authenticated) -->
      <div id="app-wrapper" style="display:none;">
        <!-- Connection info -->
        <section class="section panel">
          <div class="section-header">
            <div>
              <h2>Supabase connection</h2>
              <p class="small-note">
                Using hard-coded URL and anon key from script.
              </p>
            </div>
            <div id="connection-status" class="status-message"></div>
          </div>
        </section>

        <div class="layout">
          <!-- Menus -->
          <section class="section panel">
            <div class="section-header">
              <div>
                <h2>Menus</h2>
                <div class="small-note">
                  Create menus and pick which one is default.
                </div>
              </div>
              <div>
                <button
                  type="button"
                  class="btn-primary btn-small"
                  id="create-menu-btn"
                >
                  + New menu
                </button>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="refresh-menus-btn"
                >
                  Refresh
                </button>
              </div>
            </div>

            <div id="menus-table-container"></div>
            <div
              id="menu-edit-form-container"
              style="margin-top: 0.75rem;"
            ></div>
          </section>

          <!-- Drinks -->
<section class="section panel collapsed" id="drinks-section">
            <div class="section-header">
              <div>
                <h2>Drinks</h2>
                <div class="small-note">
                  Configure drinks and assign a category.
                </div>
              </div>
              <div>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="toggle-drinks-btn"
                >
                  Collapse list
                </button>
                <button
                  type="button"
                  class="btn-primary btn-small"
                  id="create-drink-btn"
                >
                  + New drink
                </button>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="refresh-drinks-btn"
                >
                  Refresh
                </button>
              </div>
            </div>

            <div id="drinks-table-container"></div>
            <div
              id="drink-edit-form-container"
              style="margin-top: 0.75rem;"
            ></div>
          </section>

          <!-- Categories -->
          <section class="section panel">
            <div class="section-header">
              <div>
                <h2>Categories</h2>
                <div class="small-note">
                  Used to group drinks on the guest-facing menu.
                </div>
              </div>
              <div>
                <button
                  type="button"
                  class="btn-primary btn-small"
                  id="create-category-btn"
                >
                  + New category
                </button>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="refresh-categories-btn"
                >
                  Refresh
                </button>
              </div>
            </div>

            <div id="categories-table-container"></div>
            <div
              id="category-edit-form-container"
              style="margin-top: 0.75rem;"
            ></div>
          </section>

          <!-- Syrups -->
          <section class="section panel">
            <div class="section-header">
              <div>
                <h2>Syrups</h2>
                <div class="small-note">
                  Flavours available for “add syrup” orders.
                </div>
              </div>
              <div>
                <button
                  type="button"
                  class="btn-primary btn-small"
                  id="create-syrup-btn"
                >
                  + New syrup
                </button>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="refresh-syrups-btn"
                >
                  Refresh
                </button>
              </div>
            </div>

            <div id="syrups-table-container"></div>
            <div
              id="syrup-edit-form-container"
              style="margin-top: 0.75rem;"
            ></div>
          </section>

          <!-- Orders (full width) -->
          <section class="section panel full-width">
            <div class="section-header">
              <div>
                <h2>Orders</h2>
                <div class="small-note">
                  View and manage guest orders. Manual entries on the right.
                </div>
              </div>
              <div>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="refresh-orders-btn"
                >
                  Refresh
                </button>
              </div>
            </div>

            <div class="orders-filters">
              <div>
                <label for="orders-menu-filter" class="small-note"
                  >Filter by menu</label
                >
                <select id="orders-menu-filter"></select>
              </div>
              <div>
                <label for="orders-status-filter" class="small-note"
                  >Filter by status</label
                >
                <select id="orders-status-filter">
                  <option value="all">All</option>
                  <option value="open">Open</option>
                  <option value="completed">Completed</option>
                </select>
              </div>
            </div>

            <div id="orders-table-container"></div>
          </section>

          <!-- Manual order entry -->
          <section class="section panel">
            <h2>Manual order entry</h2>
            <p class="small-note">
              Use this for test orders or when someone just shouts “flat white
              with oat” at you.
            </p>

            <form id="manual-order-form" class="manual-order-form">
              <div class="form-row">
                <label for="manual-menu-select">Menu</label>
                <select id="manual-menu-select" required></select>
              </div>
              <div class="form-row">
                <label for="manual-drink-select">Drink</label>
                <select id="manual-drink-select" required></select>
              </div>
              <div class="form-row">
                <label for="manual-name-input">Customer name</label>
                <input
                  id="manual-name-input"
                  type="text"
                  placeholder="Name on order"
                  required
                />
              </div>
              <div class="form-row">
                <label for="manual-milk-select">Milk</label>
                <select id="manual-milk-select">
                  <option value="">None / default</option>
                  <option value="Whole">Whole</option>
                  <option value="Skim">Skim</option>
                  <option value="Oat">Oat</option>
                  <option value="Almond">Almond</option>
                  <option value="Soy">Soy</option>
                </select>
              </div>
              <div class="form-row">
                <label for="manual-iced-checkbox">Iced</label>
                <input id="manual-iced-checkbox" type="checkbox" />
              </div>
              <div class="form-row">
                <label for="manual-syrup-choice">Syrup</label>
                <select id="manual-syrup-choice">
                  <option value="none">No syrup</option>
                  <option value="yes">Add syrup</option>
                </select>
              </div>
              <div class="form-row wide">
                <label for="manual-syrup-flavour-select">Syrup flavour</label>
                <select id="manual-syrup-flavour-select"></select>
              </div>
              <div class="form-row wide">
                <label for="manual-notes-input">Notes</label>
                <textarea
                  id="manual-notes-input"
                  placeholder="Extra hot, decaf, etc."
                ></textarea>
              </div>
              <div class="form-actions wide">
                <button type="submit" class="btn-primary">Create order</button>
                <span
                  id="manual-order-status"
                  class="status-message"
                ></span>
              </div>
            </form>
          </section>
        </div>
      </div>
    </main>

    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

      // Hard-coded Supabase credentials
      const SUPABASE_URL = "https://cyfdiuyjzcrommxldpwp.supabase.co";
      const SUPABASE_KEY = "sb_publishable_hzG6hrSF4DBFz9FrGC-Ghw_MSbQCHFo";

      const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

      // Auth-related DOM refs
      const authSection   = document.getElementById("auth-section");
      const appWrapper    = document.getElementById("app-wrapper");
      const loginForm     = document.getElementById("login-form");
      const loginEmail    = document.getElementById("login-email");
      const loginPassword = document.getElementById("login-password");
      const loginStatus   = document.getElementById("login-status");
      const logoutBtn     = document.getElementById("logout-btn");

      // Existing host DOM refs
      const connectionStatusEl = document.getElementById("connection-status");

      const menusTableContainer = document.getElementById(
        "menus-table-container"
      );
      const menuEditFormContainer = document.getElementById(
        "menu-edit-form-container"
      );
      const createMenuBtn = document.getElementById("create-menu-btn");
      const refreshMenusBtn = document.getElementById("refresh-menus-btn");

      const drinksTableContainer = document.getElementById(
        "drinks-table-container"
      );
      const drinkEditFormContainer = document.getElementById(
        "drink-edit-form-container"
      );
      const createDrinkBtn = document.getElementById("create-drink-btn");
      const refreshDrinksBtn = document.getElementById("refresh-drinks-btn");

      // collapsible drinks section refs
      const drinksSection = document.getElementById("drinks-section");
      const toggleDrinksBtn = document.getElementById("toggle-drinks-btn");

      const categoriesTableContainer = document.getElementById(
        "categories-table-container"
      );
      const categoryEditFormContainer = document.getElementById(
        "category-edit-form-container"
      );
      const createCategoryBtn = document.getElementById("create-category-btn");
      const refreshCategoriesBtn = document.getElementById(
        "refresh-categories-btn"
      );

      const syrupsTableContainer = document.getElementById(
        "syrups-table-container"
      );
      const syrupEditFormContainer = document.getElementById(
        "syrup-edit-form-container"
      );
      const createSyrupBtn = document.getElementById("create-syrup-btn");
      const refreshSyrupsBtn = document.getElementById("refresh-syrups-btn");

      const ordersTableContainer =
        document.getElementById("orders-table-container");
      const ordersMenuFilter =
        document.getElementById("orders-menu-filter");
      const ordersStatusFilter = document.getElementById(
        "orders-status-filter"
      );
      const refreshOrdersBtn = document.getElementById("refresh-orders-btn");

      const manualOrderForm = document.getElementById("manual-order-form");
      const manualMenuSelect = document.getElementById("manual-menu-select");
      const manualDrinkSelect = document.getElementById("manual-drink-select");
      const manualNameInput = document.getElementById("manual-name-input");
      const manualMilkSelect = document.getElementById("manual-milk-select");
      const manualIcedCheckbox = document.getElementById(
        "manual-iced-checkbox"
      );
      const manualSyrupChoice = document.getElementById(
        "manual-syrup-choice"
      );
      const manualSyrupFlavourSelect = document.getElementById(
        "manual-syrup-flavour-select"
      );
      const manualNotesInput =
        document.getElementById("manual-notes-input");
      const manualOrderStatus =
        document.getElementById("manual-order-status");

      let menusCache = [];
      let drinksCache = [];
      let categoriesCache = [];
      let syrupsCache = [];

      function setStatus(el, message, isError = false, isSuccess = false) {
        if (!el) return;
        el.textContent = message || "";
        el.classList.remove("status-error", "status-success");
        if (isError) el.classList.add("status-error");
        if (isSuccess) el.classList.add("status-success");
      }

      async function bootstrapData() {
        setStatus(connectionStatusEl, "Loading data…");

        menusTableContainer.innerHTML = "<p>Loading menus…</p>";
        drinksTableContainer.innerHTML = "<p>Loading drinks…</p>";
        categoriesTableContainer.innerHTML = "<p>Loading categories…</p>";
        syrupsTableContainer.innerHTML = "<p>Loading syrups…</p>";
        ordersTableContainer.innerHTML = "<p>Loading orders…</p>";

        categoriesCache = await fetchCategories();
        renderCategoriesTable();

        menusCache = await fetchMenus();
        renderMenusTable();

        drinksCache = await fetchDrinks();
        renderDrinksTable();

        syrupsCache = await fetchSyrups();
        renderSyrupsTable();

        refreshMenuFilters();
        refreshManualOrderMenus();
        refreshManualOrderDrinks();
        refreshManualSyrups();
        handleManualSyrupChoiceChange();

        await refreshOrders();

        setStatus(connectionStatusEl, "Connected.", false, true);
      }

      // === Menus ===
      async function fetchMenus() {
        const { data, error } = await supabaseClient
          .from("menus")
          .select("*")
          .order("created_at", { ascending: false });

        if (error) {
          console.error("Error fetching menus:", error);
          return [];
        }
        return data || [];
      }

      async function upsertMenu(menu) {
        const payload = {
          name: menu.name,
          description: menu.description,
          is_default: !!menu.is_default
        };

        if (menu.id) payload.id = menu.id;

        const { data, error } = await supabaseClient
          .from("menus")
          .upsert(payload)
          .select()
          .single();

        if (error) {
          console.error("Error upserting menu:", error);
          throw error;
        }

        if (payload.is_default && data && data.id) {
          const { error: clearError } = await supabaseClient
            .from("menus")
            .update({ is_default: false })
            .neq("id", data.id);

          if (clearError) {
            console.error("Error clearing other defaults:", clearError);
          }
        }

        return data;
      }

      async function refreshMenus() {
        menusCache = await fetchMenus();
        renderMenusTable();
        refreshMenuFilters();
        refreshManualOrderMenus();
      }

      function renderMenusTable() {
        if (!menusCache.length) {
          menusTableContainer.innerHTML =
            '<p class="small-note">No menus defined yet.</p>';
          return;
        }

        let html = `
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Default</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        for (const m of menusCache) {
          html += `
            <tr data-menu-id="${m.id}">
              <td>${m.name || ""}</td>
              <td>${m.description || ""}</td>
              <td>
                ${
                  m.is_default
                    ? '<span class="badge-default">Default</span>'
                    : ""
                }
              </td>
              <td>
                <button type="button" class="btn-secondary btn-small" data-action="edit-menu" data-id="${
                  m.id
                }">Edit</button>
                <button type="button" class="btn-danger btn-small" data-action="delete-menu" data-id="${
                  m.id
                }">Delete</button>
              </td>
            </tr>
          `;
        }

        html += "</tbody></table>";
        menusTableContainer.innerHTML = html;

        menusTableContainer
          .querySelectorAll('button[data-action="edit-menu"]')
          .forEach((btn) =>
            btn.addEventListener("click", () => {
              const menu = menusCache.find(
                (m) => m.id === btn.getAttribute("data-id")
              );
              if (menu) renderMenuEditForm(menu);
            })
          );

        menusTableContainer
          .querySelectorAll('button[data-action="delete-menu"]')
          .forEach((btn) =>
            btn.addEventListener("click", async () => {
              const id = btn.getAttribute("data-id");
              if (!window.confirm("Delete this menu?")) return;
              const { error } = await supabaseClient
                .from("menus")
                .delete()
                .eq("id", id);
              if (error) {
                console.error("Error deleting menu:", error);
                alert("Error deleting menu.");
                return;
              }
              menusCache = menusCache.filter((m) => m.id !== id);
              renderMenusTable();
              refreshMenuFilters();
              refreshManualOrderMenus();
            })
          );
      }

      function renderMenuEditForm(menu) {
        const isNew = !menu.id;
        menuEditFormContainer.innerHTML = "";

        const form = document.createElement("form");
        form.innerHTML = `
          <div class="form-row">
            <label for="menu-name-input">Name</label>
            <input id="menu-name-input" type="text" value="${
              menu.name || ""
            }" required />
          </div>
          <div class="form-row">
            <label for="menu-description-input">Description</label>
            <textarea id="menu-description-input" rows="2">${
              menu.description || ""
            }</textarea>
          </div>
          <div class="form-row">
            <label>
              <input id="menu-default-checkbox" type="checkbox" ${
                menu.is_default ? "checked" : ""
              } />
              Set as default menu
            </label>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">${
              isNew ? "Create menu" : "Save changes"
            }</button>
            <button type="button" class="btn-secondary" data-action="cancel">
              Cancel
            </button>
          </div>
          <div id="menu-form-status" class="status-message"></div>
        `;
        menuEditFormContainer.appendChild(form);

        const nameInput = document.getElementById("menu-name-input");
        const descriptionInput = document.getElementById(
          "menu-description-input"
        );
        const defaultCheckbox = document.getElementById(
          "menu-default-checkbox"
        );
        const statusEl = document.getElementById("menu-form-status");
        const cancelBtn = form.querySelector(
          'button[data-action="cancel"]'
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          setStatus(statusEl, "Saving…");

          const toSave = {
            id: menu.id || null,
            name: nameInput.value.trim(),
            description: descriptionInput.value.trim(),
            is_default: defaultCheckbox.checked
          };

          try {
            const saved = await upsertMenu(toSave);

            const idx = menusCache.findIndex((m) => m.id === saved.id);
            if (idx >= 0) {
              menusCache[idx] = saved;
            } else {
              menusCache.push(saved);
            }

            menusCache.sort((a, b) => {
              const da = a.created_at || "";
              const db = b.created_at || "";
              return da > db ? -1 : da < db ? 1 : 0;
            });

            setStatus(statusEl, "Saved.", false, true);
            renderMenusTable();
            refreshMenuFilters();
            refreshManualOrderMenus();
          } catch (error) {
            console.error("Error saving menu:", error);
            setStatus(statusEl, "Error saving menu.", true);
          }
        });

        cancelBtn.addEventListener("click", () => {
          menuEditFormContainer.innerHTML = "";
        });
      }

      function refreshMenuFilters() {
        if (!ordersMenuFilter) return;
        ordersMenuFilter.innerHTML = "";

        const allOpt = document.createElement("option");
        allOpt.value = "all";
        allOpt.textContent = "All menus";
        ordersMenuFilter.appendChild(allOpt);

        menusCache.forEach((m) => {
          const opt = document.createElement("option");
          opt.value = m.id;
          opt.textContent = m.name;
          ordersMenuFilter.appendChild(opt);
        });
      }

      // === Drinks ===
      async function fetchDrinks() {
        const { data, error } = await supabaseClient
          .from("drinks")
          .select("*")
          .order("name", { ascending: true });

        if (error) {
          console.error("Error fetching drinks:", error);
          return [];
        }
        return data || [];
      }

      async function refreshDrinks() {
        drinksCache = await fetchDrinks();
        renderDrinksTable();
        refreshManualOrderDrinks();
      }

      function renderDrinksTable() {
        if (!drinksCache.length) {
          drinksTableContainer.innerHTML =
            '<p class="small-note">No drinks defined yet.</p>';
          return;
        }

        const categoryNames = {};
        categoriesCache.forEach((c) => (categoryNames[c.id] = c.name));

        let html = `
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Category</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        for (const d of drinksCache) {
          const catName =
            d.category_id && categoryNames[d.category_id]
              ? categoryNames[d.category_id]
              : "";
          html += `
            <tr data-drink-id="${d.id}">
              <td>${d.name || ""}</td>
              <td>${catName}</td>
              <td>${d.description || ""}</td>
              <td>
                <button type="button" class="btn-secondary btn-small" data-action="edit-drink" data-id="${
                  d.id
                }">Edit</button>
                <button type="button" class="btn-danger btn-small" data-action="delete-drink" data-id="${
                  d.id
                }">Delete</button>
              </td>
            </tr>
          `;
        }

        html += "</tbody></table>";
        drinksTableContainer.innerHTML = html;

        drinksTableContainer
          .querySelectorAll('button[data-action="edit-drink"]')
          .forEach((btn) =>
            btn.addEventListener("click", () => {
              const drink = drinksCache.find(
                (d) => d.id === btn.getAttribute("data-id")
              );
              if (drink) renderDrinkEditForm(drink);
            })
          );

        drinksTableContainer
          .querySelectorAll('button[data-action="delete-drink"]')
          .forEach((btn) =>
            btn.addEventListener("click", async () => {
              const id = btn.getAttribute("data-id");
              if (!window.confirm("Delete this drink?")) return;
              const { error } = await supabaseClient
                .from("drinks")
                .delete()
                .eq("id", id);
              if (error) {
                console.error("Error deleting drink:", error);
                alert("Error deleting drink.");
                return;
              }
              await refreshDrinks();
            })
          );
      }

      function renderDrinkEditForm(drink) {
        const isNew = !drink.id;
        const categoryOptions = categoriesCache
          .map(
            (c) =>
              `<option value="${c.id}" ${
                drink.category_id === c.id ? "selected" : ""
              }>${c.name}</option>`
          )
          .join("");

        drinkEditFormContainer.innerHTML = "";

        const form = document.createElement("form");
        form.innerHTML = `
          <div class="form-row">
            <label for="drink-name-input">Name</label>
            <input id="drink-name-input" type="text" value="${
              drink.name || ""
            }" required />
          </div>
          <div class="form-row">
            <label for="drink-category-select">Category</label>
            <select id="drink-category-select">
              <option value="">None</option>
              ${categoryOptions}
            </select>
          </div>
          <div class="form-row">
            <label for="drink-description-input">Description</label>
            <textarea id="drink-description-input" rows="2">${
              drink.description || ""
            }</textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">${
              isNew ? "Create drink" : "Save changes"
            }</button>
            <button type="button" class="btn-secondary" data-action="cancel">
              Cancel
            </button>
          </div>
          <div id="drink-form-status" class="status-message"></div>
        `;
        drinkEditFormContainer.appendChild(form);

        const nameInput = document.getElementById("drink-name-input");
        const catSelect = document.getElementById("drink-category-select");
        const descInput = document.getElementById("drink-description-input");
        const statusEl = document.getElementById("drink-form-status");
        const cancelBtn = form.querySelector(
          'button[data-action="cancel"]'
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          setStatus(statusEl, "Saving…");

          const payload = {
            name: nameInput.value.trim(),
            category_id: catSelect.value || null,
            description: descInput.value.trim()
          };

          if (drink.id) {
            payload.id = drink.id;
          }

          const { data, error } = await supabaseClient
            .from("drinks")
            .upsert(payload)
            .select()
            .single();

          if (error) {
            console.error("Error saving drink:", error);
            setStatus(statusEl, "Error saving drink.", true);
            return;
          }

          const idx = drinksCache.findIndex((d) => d.id === data.id);
          if (idx >= 0) {
            drinksCache[idx] = data;
          } else {
            drinksCache.push(data);
          }

          setStatus(statusEl, "Saved.", false, true);
          renderDrinksTable();
          refreshManualOrderDrinks();
        });

        cancelBtn.addEventListener("click", () => {
          drinkEditFormContainer.innerHTML = "";
        });
      }

      // === Categories ===
      async function fetchCategories() {
        const { data, error } = await supabaseClient
          .from("categories")
          .select("*")
          .order("sort_order", { ascending: true });

        if (error) {
          console.error("Error fetching categories:", error);
          return [];
        }
        return data || [];
      }

      async function refreshCategories() {
        categoriesCache = await fetchCategories();
        renderCategoriesTable();
      }

      function renderCategoriesTable() {
        if (!categoriesCache.length) {
          categoriesTableContainer.innerHTML =
            '<p class="small-note">No categories defined yet.</p>';
          return;
        }

        let html = `
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Sort order</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        for (const c of categoriesCache) {
          html += `
            <tr data-category-id="${c.id}">
              <td>${c.name || ""}</td>
              <td>${c.sort_order ?? ""}</td>
              <td>
                <button type="button" class="btn-secondary btn-small" data-action="edit-category" data-id="${
                  c.id
                }">Edit</button>
                <button type="button" class="btn-danger btn-small" data-action="delete-category" data-id="${
                  c.id
                }">Delete</button>
              </td>
            </tr>
          `;
        }

        html += "</tbody></table>";
        categoriesTableContainer.innerHTML = html;

        categoriesTableContainer
          .querySelectorAll('button[data-action="edit-category"]')
          .forEach((btn) =>
            btn.addEventListener("click", () => {
              const category = categoriesCache.find(
                (c) => c.id === btn.getAttribute("data-id")
              );
              if (category) renderCategoryEditForm(category);
            })
          );

        categoriesTableContainer
          .querySelectorAll('button[data-action="delete-category"]')
          .forEach((btn) =>
            btn.addEventListener("click", async () => {
              const id = btn.getAttribute("data-id");
              if (!window.confirm("Delete this category?")) return;
              const { error } = await supabaseClient
                .from("categories")
                .delete()
                .eq("id", id);
              if (error) {
                console.error("Error deleting category:", error);
                alert("Error deleting category.");
                return;
              }
              categoriesCache = categoriesCache.filter((c) => c.id !== id);
              renderCategoriesTable();
              renderDrinksTable();
            })
          );
      }

      function renderCategoryEditForm(category) {
        const isNew = !category.id;
        categoryEditFormContainer.innerHTML = "";

        const form = document.createElement("form");
        form.innerHTML = `
          <div class="form-row">
            <label for="category-name-input">Name</label>
            <input id="category-name-input" type="text" value="${
              category.name || ""
            }" required />
          </div>
          <div class="form-row">
            <label for="category-sort-input">Sort order</label>
            <input id="category-sort-input" type="number" value="${
              category.sort_order ?? ""
            }" />
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">${
              isNew ? "Create category" : "Save changes"
            }</button>
            <button type="button" class="btn-secondary" data-action="cancel">
              Cancel
            </button>
          </div>
          <div id="category-form-status" class="status-message"></div>
        `;
        categoryEditFormContainer.appendChild(form);

        const nameInput = document.getElementById("category-name-input");
        const sortInput = document.getElementById("category-sort-input");
        const statusEl =
          document.getElementById("category-form-status");
        const cancelBtn = form.querySelector(
          'button[data-action="cancel"]'
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          setStatus(statusEl, "Saving…");

          const payload = {
            name: nameInput.value.trim(),
            sort_order:
              sortInput.value === "" ? null : Number(sortInput.value)
          };

          if (category.id) {
            payload.id = category.id;
          }

          const { data, error } = await supabaseClient
            .from("categories")
            .upsert(payload)
            .select()
            .single();

          if (error) {
            console.error("Error saving category:", error);
            setStatus(statusEl, "Error saving category.", true);
            return;
          }

          const idx = categoriesCache.findIndex((c) => c.id === data.id);
          if (idx >= 0) {
            categoriesCache[idx] = data;
          } else {
            categoriesCache.push(data);
            categoriesCache.sort((a, b) => {
              const sa = a.sort_order ?? 9999;
              const sb = b.sort_order ?? 9999;
              return sa - sb;
            });
          }

          setStatus(statusEl, "Saved.", false, true);
          renderCategoriesTable();
          renderDrinksTable();
        });

        cancelBtn.addEventListener("click", () => {
          categoryEditFormContainer.innerHTML = "";
        });
      }

      // === Syrups ===
      async function fetchSyrups() {
        const { data, error } = await supabaseClient
          .from("syrups")
          .select("*")
          .order("name", { ascending: true });

        if (error) {
          console.error("Error fetching syrups:", error);
          return [];
        }
        return data || [];
      }

      async function refreshSyrups() {
        syrupsCache = await fetchSyrups();
        renderSyrupsTable();
        refreshManualSyrups();
      }

      function renderSyrupsTable() {
        if (!syrupsCache.length) {
          syrupsTableContainer.innerHTML =
            '<p class="small-note">No syrups defined yet.</p>';
          return;
        }

        const menuNames = {};
        menusCache.forEach((m) => (menuNames[m.id] = m.name));

        let html = `
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Menu</th>
                <th>Notes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        for (const s of syrupsCache) {
          const menuName = s.menu_id ? menuNames[s.menu_id] || "" : "";
          html += `
            <tr data-syrup-id="${s.id}">
              <td>${s.name || ""}</td>
              <td>${menuName}</td>
              <td>${s.notes || ""}</td>
              <td>
                <button type="button" class="btn-secondary btn-small" data-action="edit-syrup" data-id="${
                  s.id
                }">Edit</button>
                <button type="button" class="btn-danger btn-small" data-action="delete-syrup" data-id="${
                  s.id
                }">Delete</button>
              </td>
            </tr>
          `;
        }

        html += "</tbody></table>";
        syrupsTableContainer.innerHTML = html;

        syrupsTableContainer
          .querySelectorAll('button[data-action="edit-syrup"]')
          .forEach((btn) =>
            btn.addEventListener("click", () => {
              const syrup = syrupsCache.find(
                (s) => s.id === btn.getAttribute("data-id")
              );
              if (syrup) renderSyrupEditForm(syrup);
            })
          );

        syrupsTableContainer
          .querySelectorAll('button[data-action="delete-syrup"]')
          .forEach((btn) =>
            btn.addEventListener("click", async () => {
              const id = btn.getAttribute("data-id");
              if (!window.confirm("Delete this syrup?")) return;
              const { error } = await supabaseClient
                .from("syrups")
                .delete()
                .eq("id", id);
              if (error) {
                console.error("Error deleting syrup:", error);
                alert("Error deleting syrup.");
                return;
              }
              syrupsCache = syrupsCache.filter((s) => s.id !== id);
              renderSyrupsTable();
              refreshManualSyrups();
            })
          );
      }

      function renderSyrupEditForm(syrup) {
        const isNew = !syrup.id;
        const menuOptions = menusCache
          .map(
            (m) =>
              `<option value="${m.id}" ${
                syrup.menu_id === m.id ? "selected" : ""
              }>${m.name}</option>`
          )
          .join("");

        syrupEditFormContainer.innerHTML = "";

        const form = document.createElement("form");
        form.innerHTML = `
          <div class="form-row">
            <label for="syrup-name-input">Name</label>
            <input id="syrup-name-input" type="text" value="${
              syrup.name || ""
            }" required />
          </div>
          <div class="form-row">
            <label for="syrup-menu-select">Menu</label>
            <select id="syrup-menu-select" required>
              <option value="">Select menu</option>
              ${menuOptions}
            </select>
          </div>
          <div class="form-row">
            <label for="syrup-notes-input">Notes</label>
            <textarea id="syrup-notes-input" rows="2">${
              syrup.notes || ""
            }</textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">${
              isNew ? "Create syrup" : "Save changes"
            }</button>
            <button type="button" class="btn-secondary" data-action="cancel">
              Cancel
            </button>
          </div>
          <div id="syrup-form-status" class="status-message"></div>
        `;
        syrupEditFormContainer.appendChild(form);

        const nameInput = document.getElementById("syrup-name-input");
        const menuSelect = document.getElementById("syrup-menu-select");
        const notesInput = document.getElementById("syrup-notes-input");
        const statusEl = document.getElementById("syrup-form-status");
        const cancelBtn = form.querySelector(
          'button[data-action="cancel"]'
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          setStatus(statusEl, "Saving…");

          const payload = {
            name: nameInput.value.trim(),
            menu_id: menuSelect.value || null,
            notes: notesInput.value.trim()
          };

          if (syrup.id) payload.id = syrup.id;

          const { data, error } = await supabaseClient
            .from("syrups")
            .upsert(payload)
            .select()
            .single();

          if (error) {
            console.error("Error saving syrup:", error);
            setStatus(statusEl, "Error saving syrup.", true);
            return;
          }

          const idx = syrupsCache.findIndex((s) => s.id === data.id);
          if (idx >= 0) {
            syrupsCache[idx] = data;
          } else {
            syrupsCache.push(data);
          }

          setStatus(statusEl, "Saved.", false, true);
          renderSyrupsTable();
          refreshManualSyrups();
        });

        cancelBtn.addEventListener("click", () => {
          syrupEditFormContainer.innerHTML = "";
        });
      }

      // === Orders ===
      async function fetchOrders() {
        const { data, error } = await supabaseClient
          .from("orders")
          .select("*")
          .order("created_at", { ascending: false });

        if (error) {
          console.error("Error fetching orders:", error);
          return [];
        }
        return data || [];
      }

      async function refreshOrders() {
        let orders = await fetchOrders();
        const menuFilterValue = ordersMenuFilter.value;
        const statusFilterValue = ordersStatusFilter.value;

        if (menuFilterValue && menuFilterValue !== "all") {
          orders = orders.filter(
            (o) => o.menu_id === menuFilterValue
          );
        }

        if (statusFilterValue === "open") {
          orders = orders.filter((o) => !o.is_completed);
        } else if (statusFilterValue === "completed") {
          orders = orders.filter((o) => o.is_completed);
        }

        renderOrdersTable(orders);
      }

      function renderOrdersTable(orders) {
        if (!orders.length) {
          ordersTableContainer.innerHTML =
            '<p class="small-note">No orders yet.</p>';
          return;
        }

        const menuNames = {};
        menusCache.forEach((m) => (menuNames[m.id] = m.name));

        let html = `
          <table class="orders-table">
            <thead>
              <tr>
                <th>Customer</th>
                <th>Drink</th>
                <th>Details</th>
                <th>Notes</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        for (const o of orders) {
          const menuName = o.menu_id ? menuNames[o.menu_id] || "" : "";
          const created = o.created_at
            ? new Date(o.created_at).toLocaleString()
            : "";
          const statusText = o.is_completed ? "Completed" : "Open";

          const flags = [];
          if (o.iced) flags.push('<span class="flag-iced">Iced</span>');
          if (o.syrup) flags.push('<span class="flag-syrup">Syrup</span>');

          html += `
            <tr data-order-id="${o.id}">
              <td>
                <div>${o.customer_name || ""}</div>
                <div class="order-meta">
                  <small>${menuName}</small><br/>
                  <small>${created}</small>
                </div>
              </td>
              <td>${o.drink || ""}</td>
              <td>
                <div class="order-flags">
                  ${flags.join("")}
                </div>
                <div class="order-meta">
                  <small>${o.milk ? "Milk: " + o.milk : ""}</small><br/>
                  <small>${o.syrup_flavour ? "Syrup: " + o.syrup_flavour : ""}</small>
                </div>
              </td>
              <td class="order-notes">
                ${o.notes || ""}
              </td>
              <td>
                <span class="badge-boolean ${
                  o.is_completed ? "true" : "false"
                }">
                  ${statusText}
                </span>
              </td>
              <td>
                <button type="button" class="btn-secondary btn-small" data-action="toggle-complete" data-id="${
                  o.id
                }">
                  Mark ${o.is_completed ? "open" : "completed"}
                </button>
                <button type="button" class="btn-danger btn-small" data-action="delete-order" data-id="${
                  o.id
                }">
                  Delete
                </button>
              </td>
            </tr>
          `;
        }

        html += "</tbody></table>";
        ordersTableContainer.innerHTML = html;

        ordersTableContainer
          .querySelectorAll('button[data-action="toggle-complete"]')
          .forEach((btn) =>
            btn.addEventListener("click", async () => {
              const id = btn.getAttribute("data-id");
              const order = orders.find((o) => o.id === id);
              if (!order) return;

              const { error } = await supabaseClient
                .from("orders")
                .update({ is_completed: !order.is_completed })
                .eq("id", id);
              if (error) {
                console.error("Error updating order:", error);
                alert("Error updating order.");
                return;
              }
              await refreshOrders();
            })
          );

        ordersTableContainer
          .querySelectorAll('button[data-action="delete-order"]')
          .forEach((btn) =>
            btn.addEventListener("click", async () => {
              const id = btn.getAttribute("data-id");
              if (!window.confirm("Delete this order?")) return;
              const { error } = await supabaseClient
                .from("orders")
                .delete()
                .eq("id", id);
              if (error) {
                console.error("Error deleting order:", error);
                alert("Error deleting order.");
                return;
              }
              await refreshOrders();
            })
          );
      }

      // === Manual order dropdowns ===
      function refreshManualOrderMenus() {
        manualMenuSelect.innerHTML = "";
        if (!menusCache.length) {
          const opt = document.createElement("option");
          opt.value = "";
          opt.textContent = "No menus";
          manualMenuSelect.appendChild(opt);
          manualMenuSelect.disabled = true;
          return;
        }
        manualMenuSelect.disabled = false;

        menusCache.forEach((m) => {
          const opt = document.createElement("option");
          opt.value = m.id;
          opt.textContent = m.name;
          manualMenuSelect.appendChild(opt);
        });
      }

      function refreshManualOrderDrinks() {
        manualDrinkSelect.innerHTML = "";
        if (!drinksCache.length) {
          const opt = document.createElement("option");
          opt.value = "";
          opt.textContent = "No drinks";
          manualDrinkSelect.appendChild(opt);
          manualDrinkSelect.disabled = true;
          return;
        }
        manualDrinkSelect.disabled = false;

        drinksCache.forEach((d) => {
          const opt = document.createElement("option");
          opt.value = d.id;
          opt.textContent = d.name;
          manualDrinkSelect.appendChild(opt);
        });
      }

      function refreshManualSyrups() {
        manualSyrupFlavourSelect.innerHTML = "";
        const noneOpt = document.createElement("option");
        noneOpt.value = "";
        noneOpt.textContent = "Select flavour";
        manualSyrupFlavourSelect.appendChild(noneOpt);

        syrupsCache.forEach((s) => {
          const opt = document.createElement("option");
          opt.value = s.name;
          opt.textContent = s.name;
          manualSyrupFlavourSelect.appendChild(opt);
        });
      }

      function handleManualSyrupChoiceChange() {
        const choice = manualSyrupChoice.value;
        if (choice === "yes") {
          manualSyrupFlavourSelect.disabled = false;
        } else {
          manualSyrupFlavourSelect.disabled = true;
          manualSyrupFlavourSelect.value = "";
        }
      }

      manualSyrupChoice.addEventListener(
        "change",
        handleManualSyrupChoiceChange
      );

      manualOrderForm.addEventListener("submit", handleManualOrderSubmit);

      async function handleManualOrderSubmit(e) {
        e.preventDefault();
        setStatus(manualOrderStatus, "Creating order…");

        const menuId = manualMenuSelect.value || null;
        const drinkId = manualDrinkSelect.value || null;
        const customerName = manualNameInput.value.trim();
        const milk = manualMilkSelect.value || null;
        const iced = manualIcedCheckbox.checked;
        const syrupChoice = manualSyrupChoice.value;
        const syrup =
          syrupChoice === "yes" ? true : false;
        const syrupFlavour =
          syrupChoice === "yes"
            ? manualSyrupFlavourSelect.value || null
            : null;
        const notes = manualNotesInput.value.trim();

        if (!drinkId || !customerName) {
          setStatus(
            manualOrderStatus,
            "Drink and customer name are required.",
            true
          );
          return;
        }

        const drink = drinksCache.find((d) => d.id === drinkId);
        if (!drink) {
          setStatus(
            manualOrderStatus,
            "Selected drink not found. Refresh drinks.",
            true
          );
          return;
        }

        const payload = {
          menu_id: menuId,
          customer_name: customerName,
          drink: drink.name,
          milk,
          iced,
          syrup,
          syrup_flavour: syrupFlavour,
          notes,
          is_completed: false
        };

        const { error } = await supabaseClient.from("orders").insert(payload);
        if (error) {
          console.error("Error creating manual order:", error);
          setStatus(manualOrderStatus, "Error creating order.", true);
          return;
        }

        setStatus(manualOrderStatus, "Order created.", false, true);
        manualOrderForm.reset();
        handleManualSyrupChoiceChange();
        await refreshOrders();
      }

      // === Button hooks ===
      createMenuBtn.addEventListener("click", () =>
        renderMenuEditForm({
          id: null,
          name: "",
          description: "",
          is_default: menusCache.length === 0
        })
      );

      refreshMenusBtn.addEventListener("click", refreshMenus);

      createDrinkBtn.addEventListener("click", () =>
        renderDrinkEditForm({
          id: null,
          name: "",
          category_id: "",
          description: ""
        })
      );

      refreshDrinksBtn.addEventListener("click", refreshDrinks);

      // collapse / expand drinks
      if (toggleDrinksBtn && drinksSection) {
        toggleDrinksBtn.addEventListener("click", () => {
          const isCollapsed = drinksSection.classList.toggle("collapsed");
          toggleDrinksBtn.textContent = isCollapsed
            ? "Expand list"
            : "Collapse list";
        });
      }

      createCategoryBtn.addEventListener("click", () =>
        renderCategoryEditForm({
          id: null,
          name: "",
          sort_order: null
        })
      );
      refreshCategoriesBtn.addEventListener("click", refreshCategories);

      createSyrupBtn.addEventListener("click", () =>
        renderSyrupEditForm({
          id: null,
          name: "",
          menu_id: null,
          notes: ""
        })
      );
      refreshSyrupsBtn.addEventListener("click", refreshSyrups);

      refreshOrdersBtn.addEventListener("click", refreshOrders);
      ordersMenuFilter.addEventListener("change", refreshOrders);
      ordersStatusFilter.addEventListener("change", refreshOrders);

      // === Auth helpers ===
      function showApp() {
        authSection.style.display = "none";
        appWrapper.style.display = "block";
      }

      function showLogin(message) {
        authSection.style.display = "block";
        appWrapper.style.display = "none";
        setStatus(loginStatus, message || "");
      }

      async function checkAuthOnLoad() {
        const { data, error } = await supabaseClient.auth.getUser();

        if (data?.user && !error) {
          showApp();
          setStatus(
            connectionStatusEl,
            "Using hard-coded Supabase connection…"
          );
          bootstrapData();
        } else {
          showLogin("Sign in to view orders.");
          setStatus(connectionStatusEl, "Not signed in.");
        }
      }

      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        setStatus(loginStatus, "Signing in…");

        const email = loginEmail.value.trim();
        const password = loginPassword.value;

        const { data, error } = await supabaseClient.auth.signInWithPassword({
          email,
          password
        });

        if (error) {
          console.error("Login error:", error);
          setStatus(loginStatus, "Login failed. Check email/password.", true);
          return;
        }

        setStatus(loginStatus, "Signed in.", false, true);
        showApp();
        setStatus(
          connectionStatusEl,
          "Using hard-coded Supabase connection…"
        );
        bootstrapData();
      });

      logoutBtn.addEventListener("click", async () => {
        await supabaseClient.auth.signOut();
        menusCache = [];
        drinksCache = [];
        categoriesCache = [];
        syrupsCache = [];
        menusTableContainer.innerHTML = "";
        drinksTableContainer.innerHTML = "";
        categoriesTableContainer.innerHTML = "";
        syrupsTableContainer.innerHTML = "";
        ordersTableContainer.innerHTML = "";
        showLogin("Signed out.");
        setStatus(connectionStatusEl, "Not signed in.");
      });

      // Initial auth check on load
      checkAuthOnLoad();
    </script>
  </body>
</html>
