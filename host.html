<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Coffee Host | Nathan</title>
    
    <style>
  :root {
    --bg-body: #020617;
    --bg-page: #020617;
    --bg-card: #020617;
    --bg-surface: #020617;
    --bg-panel: #020617;
    --border-subtle: #1f2937;
    --border-strong: #4b5563;
    --text-main: #e5e7eb;
    --text-muted: #9ca3af;
    --accent: #7c3aed;
    --accent-soft: #312e81;
    --accent-strong: #a855f7;
    --danger: #fca5a5;
    --danger-strong: #dc2626;
    --success: #6ee7b7;
    --success-soft: #064e3b;
  }

  * {
    box-sizing: border-box;
  }

  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
      sans-serif;
    margin: 0;
    padding: 0;
    background: radial-gradient(circle at top left, #020617 0, #020617 60%, #111827 100%);
    color: var(--text-main);
    min-height: 100vh;
  }

  header {
    background: #020617;
    color: var(--text-main);
    padding: 0.9rem 1.25rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 0.75rem;
    border-bottom: 1px solid #111827;
    box-shadow: 0 18px 45px rgba(0, 0, 0, 0.8);
    position: sticky;
    top: 0;
    z-index: 30;
  }

  .header-main {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
  }

  header h1 {
    margin: 0;
    font-size: 1.35rem;
    letter-spacing: 0.04em;
  }

  header h1::after {
    content: " â€¢ host console";
    font-weight: 400;
    font-size: 0.85rem;
    color: #a5b4fc;
  }

  header .subtitle {
    margin: 0;
    font-size: 0.85rem;
    opacity: 0.8;
  }

  .header-nav {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .header-nav a {
    font-size: 0.8rem;
    text-decoration: none;
    color: #e5e7eb;
    border: 1px solid #4b5563;
    border-radius: 999px;
    padding: 0.25rem 0.7rem;
    background: #020617;
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    transition: background 0.15s ease, border-color 0.15s ease,
      transform 0.1s ease;
  }

  .header-nav a::before {
    content: "ðŸ‘€";
    font-size: 0.8rem;
  }

  .header-nav a:hover {
    background: #111827;
    border-color: #9ca3af;
    transform: translateY(-1px);
  }

  main {
    padding: 1.25rem 1rem 1.5rem;
    max-width: 1100px;
    margin: 0 auto;
  }

  .layout {
    display: grid;
    grid-template-columns: 1.1fr 1.1fr;
    gap: 1.25rem;
    margin-top: 1rem;
  }

  .full-width {
    grid-column: 1 / -1;
  }

  .section {
    margin-bottom: 1.25rem;
  }

  .panel {
    background: radial-gradient(circle at top left, #111827 0, #020617 60%);
    border-radius: 16px;
    border: 1px solid var(--border-subtle);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
    padding: 1rem 1.1rem;
    position: relative;
    overflow: hidden;
  }

  .panel::before {
    content: "";
    position: absolute;
    inset-inline: 0.9rem;
    top: 0;
    height: 3px;
    border-radius: 999px;
    background: linear-gradient(90deg, #7c3aed, #ec4899);
    opacity: 0.7;
  }

  .panel h2 {
    margin-top: 0.4rem;
    font-size: 1.05rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.75rem;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .section-header h2 {
    margin: 0.35rem 0 0;
    font-size: 1.02rem;
  }

  .section-header .small-note {
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  .small-note {
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  .section-header-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.8rem;
    color: var(--text-main);
  }

  th,
  td {
    padding: 0.4rem 0.45rem;
    border-bottom: 1px solid rgba(31, 41, 55, 0.8);
    text-align: left;
  }

  th {
    background: rgba(15, 23, 42, 0.95);
    font-weight: 600;
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: #9ca3af;
  }

  tr:nth-child(even) {
    background: rgba(15, 23, 42, 0.6);
  }

  tr:nth-child(odd) {
    background: rgba(15, 23, 42, 0.25);
  }

  button {
    font-family: inherit;
    font-size: 0.8rem;
    cursor: pointer;
  }

  .btn-primary {
    background: linear-gradient(135deg, #7c3aed, #ec4899);
    color: #f9fafb;
    border: none;
    padding: 0.3rem 0.7rem;
    border-radius: 999px;
    box-shadow: 0 14px 35px rgba(124, 58, 237, 0.4);
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    transition: transform 0.1s ease, box-shadow 0.15s ease,
      filter 0.15s ease;
  }

  .btn-primary::before {
    content: "âž•";
    font-size: 0.75rem;
  }

  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 18px 45px rgba(124, 58, 237, 0.55);
    filter: brightness(1.05);
  }

  .btn-secondary {
    background-color: rgba(15, 23, 42, 0.85);
    color: var(--text-main);
    border: 1px solid var(--border-strong);
    padding: 0.3rem 0.6rem;
    border-radius: 999px;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    transition: background 0.15s ease, border-color 0.15s ease,
      transform 0.1s ease;
  }

  .btn-secondary:hover {
    background: #111827;
    border-color: #9ca3af;
    transform: translateY(-1px);
  }

  .btn-danger {
    background-color: rgba(220, 38, 38, 0.12);
    color: var(--danger);
    border: 1px solid rgba(248, 113, 113, 0.7);
    padding: 0.3rem 0.6rem;
    border-radius: 999px;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    transition: background 0.15s ease, border-color 0.15s ease,
      transform 0.1s ease;
  }

  .btn-danger::before {
    content: "ðŸ—‘";
    font-size: 0.78rem;
  }

  .btn-danger:hover {
    background: rgba(220, 38, 38, 0.25);
    border-color: var(--danger-strong);
    transform: translateY(-1px);
  }

  .btn-small {
    font-size: 0.75rem;
    padding: 0.18rem 0.45rem;
  }

  .form-row {
    margin-bottom: 0.6rem;
  }

  .form-row label {
    display: block;
    font-size: 0.8rem;
    margin-bottom: 0.15rem;
    color: var(--text-muted);
  }

  .form-row input,
  .form-row select,
  .form-row textarea {
    width: 100%;
    padding: 0.35rem 0.4rem;
    font-size: 0.82rem;
    border-radius: 8px;
    border: 1px solid var(--border-subtle);
    background: rgba(15, 23, 42, 0.85);
    color: var(--text-main);
    box-sizing: border-box;
    outline: none;
    transition: border-color 0.15s ease, box-shadow 0.15s ease,
      background 0.15s ease;
  }

  .form-row input:focus,
  .form-row select:focus,
  .form-row textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.6);
    background: #020617;
  }

  .form-row textarea {
    min-height: 52px;
    resize: vertical;
  }

  .form-actions {
    margin-top: 0.75rem;
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .status-message {
    margin-top: 0.4rem;
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  .status-error {
    color: var(--danger);
  }

  .status-success {
    color: var(--success);
  }

  .badge-default {
    display: inline-block;
    padding: 0.12rem 0.4rem;
    font-size: 0.7rem;
    border-radius: 999px;
    background: rgba(22, 163, 74, 0.15);
    color: #bbf7d0;
    border: 1px solid rgba(34, 197, 94, 0.55);
  }

  .badge-boolean {
    display: inline-block;
    padding: 0.1rem 0.4rem;
    font-size: 0.7rem;
    border-radius: 999px;
  }

  .badge-boolean.true {
    background-color: rgba(22, 163, 74, 0.2);
    color: #bbf7d0;
    border: 1px solid rgba(34, 197, 94, 0.7);
  }

  .badge-boolean.false {
    background-color: rgba(248, 113, 113, 0.18);
    color: #fecaca;
    border: 1px solid rgba(248, 113, 113, 0.75);
  }

  .orders-filters {
    display: flex;
    gap: 0.85rem;
    align-items: center;
    margin-bottom: 0.8rem;
    flex-wrap: wrap;
  }

  .orders-filters select {
    padding: 0.35rem 0.45rem;
    font-size: 0.82rem;
    border-radius: 999px;
    border: 1px solid var(--border-subtle);
    background: rgba(15, 23, 42, 0.85);
    color: var(--text-main);
    outline: none;
    transition: border-color 0.15s ease, box-shadow 0.15s ease;
  }

  .orders-filters select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.5);
  }

  .manual-order-form {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 0.5rem 0.75rem;
    align-items: end;
  }

  .manual-order-form .wide {
    grid-column: 1 / -1;
  }

  .orders-table td {
    vertical-align: top;
  }

  .orders-table small {
    color: var(--text-muted);
  }

  .orders-table .order-meta {
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  .orders-table .order-notes {
    font-size: 0.8rem;
    color: #e5e7eb;
  }

  .orders-table .order-flags {
    margin-top: 0.15rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }

  .orders-table .order-flags span {
    font-size: 0.7rem;
    padding: 0.06rem 0.38rem;
    border-radius: 999px;
    background: rgba(55, 65, 81, 0.9);
  }

  .orders-table .order-flags span.flag-iced {
    background: rgba(59, 130, 246, 0.22);
    color: #bfdbfe;
  }

  .orders-table .order-flags span.flag-syrup {
    background: rgba(252, 211, 77, 0.25);
    color: #fef9c3;
  }

  #auth-section {
    max-width: 420px;
    margin: 0 auto 1.5rem;
  }

  #login-form .form-actions {
    margin-top: 0.6rem;
  }

  #login-status {
    margin-top: 0;
  }

  .collapsible-toggle {
    border: none;
    background: transparent;
    color: var(--text-muted);
    font-size: 0.78rem;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    cursor: pointer;
    padding: 0.2rem 0.5rem;
    border-radius: 999px;
  }

  .collapsible-toggle:hover {
    background-color: rgba(148, 163, 184, 0.15);
  }

  .collapsible-toggle-icon {
    font-size: 0.85rem;
    transition: transform 0.15s ease;
  }

  #drinks-section.collapsed .collapsible-toggle-icon {
    transform: rotate(-90deg);
  }

  #drinks-section.collapsed #drinks-table-container {
    display: none;
  }

  @media (max-width: 900px) {
    .layout {
      grid-template-columns: 1fr;
    }

    .manual-order-form {
      grid-template-columns: 1fr;
    }

    header {
      padding-inline: 0.85rem;
    }

    main {
      padding-inline: 0.75rem;
    }
  }
</style>
  </head>
  <body>
    <header>
      <div class="header-main">
        <h1>Thistle &amp; Cherry Blossom</h1>
        <p class="subtitle">Host control panel</p>
      </div>
      <div class="header-nav">
        <a href="index.html">View guest screen</a>
      </div>
    </header>

    <main>
      <!-- Auth section -->
      <section class="section panel" id="auth-section">
        <h2>Authentication</h2>
        <p class="small-note">
          Sign in as a host to manage menus, drinks, and orders.
        </p>
        <form id="login-form">
          <div class="form-row">
            <label for="email">Email</label>
            <input type="email" id="email" required />
          </div>
          <div class="form-row">
            <label for="password">Password</label>
            <input type="password" id="password" required />
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Sign in</button>
            <span id="login-status" class="status-message"></span>
          </div>
        </form>
      </section>

      <section id="app-section" style="display: none">
        <div class="layout">
          <!-- Menus -->
          <section class="section panel">
            <div class="section-header">
              <div>
                <h2>Menus</h2>
                <div class="small-note">
                  Create menus for different events or days.
                </div>
              </div>
              <div>
                <button
                  type="button"
                  class="btn-primary btn-small"
                  id="create-menu-btn"
                >
                  + New menu
                </button>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="refresh-menus-btn"
                >
                  Refresh
                </button>
              </div>
            </div>

            <div id="menus-table-container"></div>
            <div
              id="menu-edit-form-container"
              style="margin-top: 0.75rem"
            ></div>
          </section>

          <!-- Drinks -->
          <section class="section panel" id="drinks-section">
            <div class="section-header">
              <div>
                <h2>Drinks</h2>
                <div class="small-note">
                  Configure drinks and assign a category.
                </div>
              </div>
              <div class="section-header-actions">
                <button
                  type="button"
                  class="collapsible-toggle"
                  id="toggle-drinks-list-btn"
                >
                  <span class="collapsible-toggle-icon">â–¾</span>
                  <span class="collapsible-toggle-label">Hide list</span>
                </button>
                <button
                  type="button"
                  class="btn-primary btn-small"
                  id="create-drink-btn"
                >
                  + New drink
                </button>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="refresh-drinks-btn"
                >
                  Refresh
                </button>
              </div>
            </div>

            <div id="drinks-table-container"></div>
            <div
              id="drink-edit-form-container"
              style="margin-top: 0.75rem;"
            ></div>
          </section>

          <!-- Categories -->
          <section class="section panel">
            <div class="section-header">
              <div>
                <h2>Categories</h2>
                <div class="small-note">
                  Group your drinks (e.g., Coffee, Tea, Alcohol).
                </div>
              </div>
              <div>
                <button
                  type="button"
                  class="btn-primary btn-small"
                  id="create-category-btn"
                >
                  + New category
                </button>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="refresh-categories-btn"
                >
                  Refresh
                </button>
              </div>
            </div>

            <div id="categories-table-container"></div>
            <div
              id="category-edit-form-container"
              style="margin-top: 0.75rem"
            ></div>
          </section>

          <!-- Syrups -->
          <section class="section panel">
            <div class="section-header">
              <div>
                <h2>Syrups</h2>
                <div class="small-note">
                  Manage syrup flavours and options.
                </div>
              </div>
              <div>
                <button
                  type="button"
                  class="btn-primary btn-small"
                  id="create-syrup-btn"
                >
                  + New syrup
                </button>
                <button
                  type="button"
                  class="btn-secondary btn-small"
                  id="refresh-syrups-btn"
                >
                  Refresh
                </button>
              </div>
            </div>

            <div id="syrups-table-container"></div>
            <div
              id="syrup-edit-form-container"
              style="margin-top: 0.75rem"
            ></div>
          </section>

          <!-- Orders -->
          <section class="section panel full-width">
            <div class="section-header">
              <div>
                <h2>Orders</h2>
                <div class="small-note">
                  View orders submitted from the guest page and record
                  manual ones.
                </div>
              </div>
            </div>

            <div class="orders-filters">
              <label>
                Filter by menu:
                <select id="orders-menu-filter">
                  <option value="">All menus</option>
                </select>
              </label>
              <label>
                Status:
                <select id="orders-status-filter">
                  <option value="">All</option>
                  <option value="pending">Pending</option>
                  <option value="completed">Completed</option>
                </select>
              </label>
            </div>

            <div id="orders-table-container"></div>

            <h3 style="margin-top: 1rem">Manual order</h3>
            <form id="manual-order-form" class="manual-order-form">
              <div class="form-row">
                <label for="manual-order-name">Name</label>
                <input id="manual-order-name" required />
              </div>
              <div class="form-row">
                <label for="manual-order-drink">Drink</label>
                <select id="manual-order-drink" required></select>
              </div>
              <div class="form-row">
                <label for="manual-order-menu">Menu</label>
                <select id="manual-order-menu" required></select>
              </div>
              <div class="form-row">
                <label
                  ><input
                    type="checkbox"
                    id="manual-order-iced"
                  />
                  Iced</label
                >
              </div>
              <div class="form-row">
                <label for="manual-order-syrup">Syrup</label>
                <select id="manual-order-syrup">
                  <option value="">None</option>
                </select>
              </div>
              <div class="form-row wide">
                <label for="manual-order-notes">Notes</label>
                <textarea
                  id="manual-order-notes"
                  rows="2"
                  placeholder="Any special instructions..."
                ></textarea>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn-primary">
                  Add order
                </button>
                <span
                  id="manual-order-status"
                  class="status-message"
                ></span>
              </div>
            </form>
          </section>
        </div>
      </section>
    </main>

    <script type="module">
      const SUPABASE_URL = "https://your-project-id.supabase.co";
      const SUPABASE_ANON_KEY = "your-anon-public-key";

      const { createClient } = window.supabase;
      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const authSection = document.getElementById("auth-section");
      const appSection = document.getElementById("app-section");
      const loginForm = document.getElementById("login-form");
      const loginStatusEl = document.getElementById("login-status");

      const menusTableContainer = document.getElementById(
        "menus-table-container"
      );
      const menuEditFormContainer = document.getElementById(
        "menu-edit-form-container"
      );
      const createMenuBtn = document.getElementById("create-menu-btn");
      const refreshMenusBtn = document.getElementById("refresh-menus-btn");

      const drinksSection = document.getElementById("drinks-section");
      const drinksTableContainer = document.getElementById(
        "drinks-table-container"
      );
      const drinkEditFormContainer = document.getElementById(
        "drink-edit-form-container"
      );
      const createDrinkBtn = document.getElementById("create-drink-btn");
      const refreshDrinksBtn = document.getElementById("refresh-drinks-btn");
      const toggleDrinksListBtn = document.getElementById(
        "toggle-drinks-list-btn"
      );
      const toggleDrinksListIcon = toggleDrinksListBtn
        ? toggleDrinksListBtn.querySelector(".collapsible-toggle-icon")
        : null;
      const toggleDrinksListLabel = toggleDrinksListBtn
        ? toggleDrinksListBtn.querySelector(".collapsible-toggle-label")
        : null;

      const categoriesTableContainer = document.getElementById(
        "categories-table-container"
      );
      const categoryEditFormContainer = document.getElementById(
        "category-edit-form-container"
      );
      const createCategoryBtn = document.getElementById("create-category-btn");
      const refreshCategoriesBtn = document.getElementById(
        "refresh-categories-btn"
      );

      if (toggleDrinksListBtn && drinksSection) {
        toggleDrinksListBtn.addEventListener("click", () => {
          const isCollapsed = drinksSection.classList.toggle("collapsed");
          if (toggleDrinksListIcon) {
            toggleDrinksListIcon.textContent = isCollapsed ? "â–¸" : "â–¾";
          }
          if (toggleDrinksListLabel) {
            toggleDrinksListLabel.textContent = isCollapsed
              ? "Show list"
              : "Hide list";
          }
        });
      }

      const syrupsTableContainer = document.getElementById(
        "syrups-table-container"
      );
      const syrupEditFormContainer = document.getElementById(
        "syrup-edit-form-container"
      );
      const createSyrupBtn = document.getElementById("create-syrup-btn");
      const refreshSyrupsBtn = document.getElementById("refresh-syrups-btn");

      const ordersTableContainer = document.getElementById(
        "orders-table-container"
      );
      const ordersMenuFilter = document.getElementById("orders-menu-filter");
      const ordersStatusFilter = document.getElementById(
        "orders-status-filter"
      );
      const manualOrderForm = document.getElementById("manual-order-form");
      const manualOrderStatusEl = document.getElementById(
        "manual-order-status"
      );
      const manualOrderNameInput =
        document.getElementById("manual-order-name");
      const manualOrderDrinkSelect = document.getElementById(
        "manual-order-drink"
      );
      const manualOrderMenuSelect =
        document.getElementById("manual-order-menu");
      const manualOrderIcedCheckbox = document.getElementById(
        "manual-order-iced"
      );
      const manualOrderSyrupSelect = document.getElementById(
        "manual-order-syrup"
      );
      const manualOrderNotesTextarea = document.getElementById(
        "manual-order-notes"
      );

      function setLoginStatus(message, isError = false) {
        loginStatusEl.textContent = message;
        loginStatusEl.className = "status-message";
        if (message) {
          loginStatusEl.classList.add(
            isError ? "status-error" : "status-success"
          );
        }
      }

      loginForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        setLoginStatus("Signing in...");

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        try {
          const { data, error } =
            await supabase.auth.signInWithPassword({
              email,
              password
            });

          if (error) {
            console.error(error);
            setLoginStatus(
              "Login failed. Please check your email/password.",
              true
            );
            return;
          }

          setLoginStatus("Signed in.");
          authSection.style.display = "none";
          appSection.style.display = "block";

          refreshAllData();
        } catch (err) {
          console.error(err);
          setLoginStatus("Unexpected error during login.", true);
        }
      });

      function setAppStatus(container, message, isError = false) {
        if (!container) return;
        let statusEl = container.querySelector(".status-message-inline");
        if (!statusEl) {
          statusEl = document.createElement("div");
          statusEl.className = "status-message-inline status-message";
          statusEl.style.marginTop = "0.4rem";
          container.appendChild(statusEl);
        }
        statusEl.textContent = message;
        statusEl.classList.remove("status-error", "status-success");
        if (message) {
          statusEl.classList.add(
            isError ? "status-error" : "status-success"
          );
        }
      }

      async function refreshAllData() {
        await Promise.all([
          refreshMenus(),
          refreshCategories(),
          refreshDrinks(),
          refreshSyrups(),
          refreshOrders()
        ]);
        populateOrderDropdowns();
      }

      async function refreshMenus() {
        setAppStatus(menusTableContainer, "Loading menus...");

        const { data, error } = await supabase
          .from("menus")
          .select("*")
          .order("name", { ascending: true });

        if (error) {
          console.error(error);
          menusTableContainer.innerHTML = "";
          setAppStatus(
            menusTableContainer,
            "Failed to load menus.",
            true
          );
          return;
        }

        renderMenusTable(data || []);
      }

      function renderMenusTable(menus) {
        menusTableContainer.innerHTML = "";

        if (!menus.length) {
          menusTableContainer.innerHTML =
            "<p>No menus found. Create one to get started.</p>";
          return;
        }

        const table = document.createElement("table");
        table.innerHTML = `
          <thead>
            <tr>
              <th>Name</th>
              <th>Active</th>
              <th>Last updated</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        `;

        const tbody = table.querySelector("tbody");

        menus.forEach((menu) => {
          const tr = document.createElement("tr");

          const nameTd = document.createElement("td");
          nameTd.textContent = menu.name || "(no name)";
          tr.appendChild(nameTd);

          const activeTd = document.createElement("td");
          const badge = document.createElement("span");
          badge.className =
            "badge-boolean " + (menu.is_active ? "true" : "false");
          badge.textContent = menu.is_active ? "Active" : "Inactive";
          activeTd.appendChild(badge);
          tr.appendChild(activeTd);

          const updatedTd = document.createElement("td");
          updatedTd.textContent = menu.updated_at
            ? new Date(menu.updated_at).toLocaleString()
            : "";
          tr.appendChild(updatedTd);

          const actionsTd = document.createElement("td");

          const editBtn = document.createElement("button");
          editBtn.type = "button";
          editBtn.className = "btn-secondary btn-small";
          editBtn.textContent = "Edit";
          editBtn.addEventListener("click", () =>
            renderMenuEditForm(menu)
          );
          actionsTd.appendChild(editBtn);

          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.className = "btn-danger btn-small";
          deleteBtn.textContent = "Delete";
          deleteBtn.addEventListener("click", () =>
            deleteMenu(menu.id)
          );
          actionsTd.appendChild(deleteBtn);

          tr.appendChild(actionsTd);
          tbody.appendChild(tr);
        });

        menusTableContainer.appendChild(table);
      }

      function renderMenuEditForm(menu) {
        menuEditFormContainer.innerHTML = "";

        const isNew = !menu.id;

        const form = document.createElement("form");
        form.innerHTML = `
        <div class="form-row">
          <label for="menu-name-input">Menu name</label>
          <input id="menu-name-input" required value="${
            menu.name || ""
          }" />
        </div>
        <div class="form-row">
          <label>
            <input type="checkbox" id="menu-active-input" ${
              menu.is_active ? "checked" : ""
            } />
            Active
          </label>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-primary">
            ${isNew ? "Create menu" : "Save changes"}
          </button>
          <button type="button" class="btn-secondary" id="cancel-menu-edit">
            Cancel
          </button>
          <span class="status-message" id="menu-edit-status"></span>
        </div>
      `;

        menuEditFormContainer.appendChild(form);

        const nameInput = form.querySelector("#menu-name-input");
        const activeInput = form.querySelector("#menu-active-input");
        const statusEl = form.querySelector("#menu-edit-status");
        const cancelBtn = form.querySelector("#cancel-menu-edit");

        cancelBtn.addEventListener(
          "click",
          () => (menuEditFormContainer.innerHTML = "")
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          statusEl.textContent = isNew
            ? "Creating menu..."
            : "Updating menu...";
          statusEl.className = "status-message";

          const payload = {
            name: nameInput.value.trim(),
            is_active: activeInput.checked
          };

          try {
            let error;

            if (isNew) {
              ({ error } = await supabase
                .from("menus")
                .insert(payload));
            } else {
              ({ error } = await supabase
                .from("menus")
                .update(payload)
                .eq("id", menu.id));
            }

            if (error) {
              console.error(error);
              statusEl.textContent = "Error saving menu.";
              statusEl.classList.add("status-error");
              return;
            }

            statusEl.textContent = "Saved.";
            statusEl.classList.add("status-success");

            await refreshMenus();
            await refreshOrders();
            populateOrderDropdowns();
            setTimeout(() => (menuEditFormContainer.innerHTML = ""), 500);
          } catch (err) {
            console.error(err);
            statusEl.textContent = "Unexpected error.";
            statusEl.classList.add("status-error");
          }
        });
      }

      async function deleteMenu(menuId) {
        if (!confirm("Delete this menu?")) return;

        setAppStatus(menusTableContainer, "Deleting menu...");

        const { error } = await supabase
          .from("menus")
          .delete()
          .eq("id", menuId);

        if (error) {
          console.error(error);
          setAppStatus(menusTableContainer, "Failed to delete menu.", true);
          return;
        }

        setAppStatus(menusTableContainer, "Deleted menu.");
        await refreshMenus();
        await refreshOrders();
        populateOrderDropdowns();
      }

      async function refreshDrinks() {
        setAppStatus(drinksTableContainer, "Loading drinks...");

        const { data, error } = await supabase
          .from("drinks")
          .select("*, categories(name)")
          .order("name", { ascending: true });

        if (error) {
          console.error(error);
          drinksTableContainer.innerHTML = "";
          setAppStatus(
            drinksTableContainer,
            "Failed to load drinks.",
            true
          );
          return;
        }

        renderDrinksTable(data || []);
        populateOrderDropdowns();
      }

      function renderDrinksTable(drinks) {
        drinksTableContainer.innerHTML = "";

        if (!drinks.length) {
          drinksTableContainer.innerHTML =
            "<p>No drinks found. Create one to get started.</p>";
          return;
        }

        const table = document.createElement("table");
        table.className = "drinks-table";
        table.innerHTML = `
          <thead>
            <tr>
              <th>Name</th>
              <th>Category</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        `;

        const tbody = table.querySelector("tbody");

        drinks.forEach((drink) => {
          const tr = document.createElement("tr");

          const nameTd = document.createElement("td");
          nameTd.textContent = drink.name || "(no name)";
          tr.appendChild(nameTd);

          const categoryTd = document.createElement("td");
          categoryTd.textContent =
            (drink.categories && drink.categories.name) || "";
          tr.appendChild(categoryTd);

          const descriptionTd = document.createElement("td");
          descriptionTd.textContent = drink.description || "";
          tr.appendChild(descriptionTd);

          const actionsTd = document.createElement("td");

          const editBtn = document.createElement("button");
          editBtn.type = "button";
          editBtn.className = "btn-secondary btn-small";
          editBtn.textContent = "Edit";
          editBtn.addEventListener("click", () =>
            renderDrinkEditForm(drink)
          );
          actionsTd.appendChild(editBtn);

          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.className = "btn-danger btn-small";
          deleteBtn.textContent = "Delete";
          deleteBtn.addEventListener("click", () =>
            deleteDrink(drink.id)
          );
          actionsTd.appendChild(deleteBtn);

          tr.appendChild(actionsTd);

          tbody.appendChild(tr);
        });

        drinksTableContainer.appendChild(table);
      }

      async function loadCategoriesOptions() {
        const { data, error } = await supabase
          .from("categories")
          .select("*")
          .order("name", { ascending: true });

        if (error) {
          console.error(error);
          return [];
        }

        return data || [];
      }

      async function renderDrinkEditForm(drink) {
        drinkEditFormContainer.innerHTML = "";
        const isNew = !drink.id;

        let categories = await loadCategoriesOptions();

        const form = document.createElement("form");

        const categoryOptionsHtml = categories
          .map(
            (c) => `
          <option value="${c.id}" ${
              drink.category_id === c.id ? "selected" : ""
            }>
            ${c.name}
          </option>
        `
          )
          .join("");

        form.innerHTML = `
        <div class="form-row">
          <label for="drink-name-input">Drink name</label>
          <input id="drink-name-input" required value="${
            drink.name || ""
          }" />
        </div>
        <div class="form-row">
          <label for="drink-category-input">Category</label>
          <select id="drink-category-input" required>
            <option value="">Select a category</option>
            ${categoryOptionsHtml}
          </select>
        </div>
        <div class="form-row">
          <label for="drink-description-input">Description</label>
          <textarea id="drink-description-input" rows="2">${
            drink.description || ""
          }</textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-primary">
            ${isNew ? "Create drink" : "Save changes"}
          </button>
          <button type="button" class="btn-secondary" id="cancel-drink-edit">
            Cancel
          </button>
          <span class="status-message" id="drink-edit-status"></span>
        </div>
      `;

        drinkEditFormContainer.appendChild(form);

        const nameInput = form.querySelector("#drink-name-input");
        const categoryInput = form.querySelector("#drink-category-input");
        const descriptionInput = form.querySelector(
          "#drink-description-input"
        );
        const statusEl = form.querySelector("#drink-edit-status");
        const cancelBtn = form.querySelector("#cancel-drink-edit");

        cancelBtn.addEventListener(
          "click",
          () => (drinkEditFormContainer.innerHTML = "")
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          statusEl.textContent = isNew
            ? "Creating drink..."
            : "Updating drink...";
          statusEl.className = "status-message";

          const payload = {
            name: nameInput.value.trim(),
            category_id: categoryInput.value || null,
            description: descriptionInput.value.trim() || null
          };

          try {
            let error;

            if (isNew) {
              ({ error } = await supabase
                .from("drinks")
                .insert(payload));
            } else {
              ({ error } = await supabase
                .from("drinks")
                .update(payload)
                .eq("id", drink.id));
            }

            if (error) {
              console.error(error);
              statusEl.textContent = "Error saving drink.";
              statusEl.classList.add("status-error");
              return;
            }

            statusEl.textContent = "Saved.";
            statusEl.classList.add("status-success");

            await refreshDrinks();
            populateOrderDropdowns();
            setTimeout(() => (drinkEditFormContainer.innerHTML = ""), 500);
          } catch (err) {
            console.error(err);
            statusEl.textContent = "Unexpected error.";
            statusEl.classList.add("status-error");
          }
        });
      }

      async function deleteDrink(drinkId) {
        if (!confirm("Delete this drink?")) return;

        setAppStatus(drinksTableContainer, "Deleting drink...");

        const { error } = await supabase
          .from("drinks")
          .delete()
          .eq("id", drinkId);

        if (error) {
          console.error(error);
          setAppStatus(
            drinksTableContainer,
            "Failed to delete drink.",
            true
          );
          return;
        }

        setAppStatus(drinksTableContainer, "Deleted drink.");
        await refreshDrinks();
        populateOrderDropdowns();
      }

      async function refreshCategories() {
        setAppStatus(
          categoriesTableContainer,
          "Loading categories..."
        );

        const { data, error } = await supabase
          .from("categories")
          .select("*")
          .order("name", { ascending: true });

        if (error) {
          console.error(error);
          categoriesTableContainer.innerHTML = "";
          setAppStatus(
            categoriesTableContainer,
            "Failed to load categories.",
            true
          );
          return;
        }

        renderCategoriesTable(data || []);
      }

      function renderCategoriesTable(categories) {
        categoriesTableContainer.innerHTML = "";

        if (!categories.length) {
          categoriesTableContainer.innerHTML =
            "<p>No categories found. Create one to get started.</p>";
          return;
        }

        const table = document.createElement("table");
        table.innerHTML = `
          <thead>
            <tr>
              <th>Name</th>
              <th>Sort order</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        `;

        const tbody = table.querySelector("tbody");

        categories.forEach((category) => {
          const tr = document.createElement("tr");

          const nameTd = document.createElement("td");
          nameTd.textContent = category.name || "(no name)";
          tr.appendChild(nameTd);

          const sortOrderTd = document.createElement("td");
          sortOrderTd.textContent =
            category.sort_order !== null &&
            category.sort_order !== undefined
              ? category.sort_order
              : "";
          tr.appendChild(sortOrderTd);

          const actionsTd = document.createElement("td");

          const editBtn = document.createElement("button");
          editBtn.type = "button";
          editBtn.className = "btn-secondary btn-small";
          editBtn.textContent = "Edit";
          editBtn.addEventListener("click", () =>
            renderCategoryEditForm(category)
          );
          actionsTd.appendChild(editBtn);

          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.className = "btn-danger btn-small";
          deleteBtn.textContent = "Delete";
          deleteBtn.addEventListener("click", () =>
            deleteCategory(category.id)
          );
          actionsTd.appendChild(deleteBtn);

          tr.appendChild(actionsTd);

          tbody.appendChild(tr);
        });

        categoriesTableContainer.appendChild(table);
      }

      function renderCategoryEditForm(category) {
        categoryEditFormContainer.innerHTML = "";

        const isNew = !category.id;

        const form = document.createElement("form");
        form.innerHTML = `
        <div class="form-row">
          <label for="category-name-input">Category name</label>
          <input id="category-name-input" required value="${
            category.name || ""
          }" />
        </div>
        <div class="form-row">
          <label for="category-sort-order-input">Sort order (optional)</label>
          <input
            type="number"
            id="category-sort-order-input"
            value="${
              category.sort_order !== null &&
              category.sort_order !== undefined
                ? category.sort_order
                : ""
            }"
          />
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-primary">
            ${isNew ? "Create category" : "Save changes"}
          </button>
          <button type="button" class="btn-secondary" id="cancel-category-edit">
            Cancel
          </button>
          <span class="status-message" id="category-edit-status"></span>
        </div>
      `;

        categoryEditFormContainer.appendChild(form);

        const nameInput = form.querySelector("#category-name-input");
        const sortOrderInput = form.querySelector(
          "#category-sort-order-input"
        );
        const statusEl = form.querySelector("#category-edit-status");
        const cancelBtn = form.querySelector("#cancel-category-edit");

        cancelBtn.addEventListener(
          "click",
          () => (categoryEditFormContainer.innerHTML = "")
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          statusEl.textContent = isNew
            ? "Creating category..."
            : "Updating category...";
          statusEl.className = "status-message";

          const sortOrderValue = sortOrderInput.value.trim();
          const payload = {
            name: nameInput.value.trim(),
            sort_order:
              sortOrderValue === ""
                ? null
                : Number.parseInt(sortOrderValue, 10)
          };

          try {
            let error;

            if (isNew) {
              ({ error } = await supabase
                .from("categories")
                .insert(payload));
            } else {
              ({ error } = await supabase
                .from("categories")
                .update(payload)
                .eq("id", category.id));
            }

            if (error) {
              console.error(error);
              statusEl.textContent = "Error saving category.";
              statusEl.classList.add("status-error");
              return;
            }

            statusEl.textContent = "Saved.";
            statusEl.classList.add("status-success");

            await refreshCategories();
            await refreshDrinks();
            populateOrderDropdowns();
            setTimeout(
              () => (categoryEditFormContainer.innerHTML = ""),
              500
            );
          } catch (err) {
            console.error(err);
            statusEl.textContent = "Unexpected error.";
            statusEl.classList.add("status-error");
          }
        });
      }

      async function deleteCategory(categoryId) {
        if (!confirm("Delete this category?")) return;

        setAppStatus(
          categoriesTableContainer,
          "Deleting category..."
        );

        const { error } = await supabase
          .from("categories")
          .delete()
          .eq("id", categoryId);

        if (error) {
          console.error(error);
          setAppStatus(
            categoriesTableContainer,
            "Failed to delete category.",
            true
          );
          return;
        }

        setAppStatus(categoriesTableContainer, "Deleted category.");
        await refreshCategories();
        await refreshDrinks();
        populateOrderDropdowns();
      }

      async function refreshSyrups() {
        setAppStatus(syrupsTableContainer, "Loading syrups...");

        const { data, error } = await supabase
          .from("syrups")
          .select("*")
          .order("name", { ascending: true });

        if (error) {
          console.error(error);
          syrupsTableContainer.innerHTML = "";
          setAppStatus(
            syrupsTableContainer,
            "Failed to load syrups.",
            true
          );
          return;
        }

        renderSyrupsTable(data || []);
        populateOrderDropdowns();
      }

      function renderSyrupsTable(syrups) {
        syrupsTableContainer.innerHTML = "";

        if (!syrups.length) {
          syrupsTableContainer.innerHTML =
            "<p>No syrups found. Create one to get started.</p>";
          return;
        }

        const table = document.createElement("table");
        table.innerHTML = `
          <thead>
            <tr>
              <th>Name</th>
              <th>Flavour</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        `;

        const tbody = table.querySelector("tbody");

        syrups.forEach((syrup) => {
          const tr = document.createElement("tr");

          const nameTd = document.createElement("td");
          nameTd.textContent = syrup.name || "(no name)";
          tr.appendChild(nameTd);

          const flavourTd = document.createElement("td");
          flavourTd.textContent = syrup.flavour || "";
          tr.appendChild(flavourTd);

          const actionsTd = document.createElement("td");

          const editBtn = document.createElement("button");
          editBtn.type = "button";
          editBtn.className = "btn-secondary btn-small";
          editBtn.textContent = "Edit";
          editBtn.addEventListener("click", () =>
            renderSyrupEditForm(syrup)
          );
          actionsTd.appendChild(editBtn);

          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.className = "btn-danger btn-small";
          deleteBtn.textContent = "Delete";
          deleteBtn.addEventListener("click", () =>
            deleteSyrup(syrup.id)
          );
          actionsTd.appendChild(deleteBtn);

          tr.appendChild(actionsTd);

          tbody.appendChild(tr);
        });

        syrupsTableContainer.appendChild(table);
      }

      function renderSyrupEditForm(syrup) {
        syrupEditFormContainer.innerHTML = "";

        const isNew = !syrup.id;

        const form = document.createElement("form");
        form.innerHTML = `
        <div class="form-row">
          <label for="syrup-name-input">Syrup name</label>
          <input id="syrup-name-input" required value="${
            syrup.name || ""
          }" />
        </div>
        <div class="form-row">
          <label for="syrup-flavour-input">Flavour</label>
          <input id="syrup-flavour-input" value="${
            syrup.flavour || ""
          }" />
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-primary">
            ${isNew ? "Create syrup" : "Save changes"}
          </button>
          <button type="button" class="btn-secondary" id="cancel-syrup-edit">
            Cancel
          </button>
          <span class="status-message" id="syrup-edit-status"></span>
        </div>
      `;

        syrupEditFormContainer.appendChild(form);

        const nameInput = form.querySelector("#syrup-name-input");
        const flavourInput = form.querySelector("#syrup-flavour-input");
        const statusEl = form.querySelector("#syrup-edit-status");
        const cancelBtn = form.querySelector("#cancel-syrup-edit");

        cancelBtn.addEventListener(
          "click",
          () => (syrupEditFormContainer.innerHTML = "")
        );

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          statusEl.textContent = isNew
            ? "Creating syrup..."
            : "Updating syrup...";
          statusEl.className = "status-message";

          const payload = {
            name: nameInput.value.trim(),
            flavour: flavourInput.value.trim() || null
          };

          try {
            let error;

            if (isNew) {
              ({ error } = await supabase
                .from("syrups")
                .insert(payload));
            } else {
              ({ error } = await supabase
                .from("syrups")
                .update(payload)
                .eq("id", syrup.id));
            }

            if (error) {
              console.error(error);
              statusEl.textContent = "Error saving syrup.";
              statusEl.classList.add("status-error");
              return;
            }

            statusEl.textContent = "Saved.";
            statusEl.classList.add("status-success");

            await refreshSyrups();
            populateOrderDropdowns();
            setTimeout(
              () => (syrupEditFormContainer.innerHTML = ""),
              500
            );
          } catch (err) {
            console.error(err);
            statusEl.textContent = "Unexpected error.";
            statusEl.classList.add("status-error");
          }
        });
      }

      async function deleteSyrup(syrupId) {
        if (!confirm("Delete this syrup?")) return;

        setAppStatus(syrupsTableContainer, "Deleting syrup...");

        const { error } = await supabase
          .from("syrups")
          .delete()
          .eq("id", syrupId);

        if (error) {
          console.error(error);
          setAppStatus(
            syrupsTableContainer,
            "Failed to delete syrup.",
            true
          );
          return;
        }

        setAppStatus(syrupsTableContainer, "Deleted syrup.");
        await refreshSyrups();
        populateOrderDropdowns();
      }

      async function refreshOrders() {
        setAppStatus(ordersTableContainer, "Loading orders...");

        let query = supabase
          .from("orders")
          .select(
            `
          *,
          menus(name),
          drinks(name),
          syrups(name)
        `
          )
          .order("created_at", { ascending: false });

        const filterMenuId = ordersMenuFilter.value;
        const filterStatus = ordersStatusFilter.value;

        if (filterMenuId) {
          query = query.eq("menu_id", filterMenuId);
        }
        if (filterStatus) {
          query = query.eq("status", filterStatus);
        }

        const { data, error } = await query;

        if (error) {
          console.error(error);
          ordersTableContainer.innerHTML = "";
          setAppStatus(
            ordersTableContainer,
            "Failed to load orders.",
            true
          );
          return;
        }

        renderOrdersTable(data || []);
      }

      function renderOrdersTable(orders) {
        ordersTableContainer.innerHTML = "";

        if (!orders.length) {
          ordersTableContainer.innerHTML =
            "<p>No orders yet. Time to caffeinate people.</p>";
          return;
        }

        const table = document.createElement("table");
        table.className = "orders-table";
        table.innerHTML = `
          <thead>
            <tr>
              <th>Time</th>
              <th>Name</th>
              <th>Drink</th>
              <th>Notes</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        `;

        const tbody = table.querySelector("tbody");

        orders.forEach((order) => {
          const tr = document.createElement("tr");

          const timeTd = document.createElement("td");
          timeTd.textContent = order.created_at
            ? new Date(order.created_at).toLocaleTimeString([], {
                hour: "2-digit",
                minute: "2-digit"
              })
            : "";
          tr.appendChild(timeTd);

          const nameTd = document.createElement("td");
          nameTd.textContent = order.name || "(no name)";
          tr.appendChild(nameTd);

          const drinkTd = document.createElement("td");
          const drinkLines = [];
          if (order.drinks && order.drinks.name) {
            drinkLines.push(order.drinks.name);
          }
          if (order.menus && order.menus.name) {
            drinkLines.push(`Menu: ${order.menus.name}`);
          }
          if (order.syrups && order.syrups.name) {
            drinkLines.push(`Syrup: ${order.syrups.name}`);
          }
          drinkTd.innerHTML = drinkLines.join("<br />");
          tr.appendChild(drinkTd);

          const notesTd = document.createElement("td");
          const metaDiv = document.createElement("div");
          metaDiv.className = "order-meta";

          const flagsDiv = document.createElement("div");
          flagsDiv.className = "order-flags";

          if (order.is_iced) {
            const icedSpan = document.createElement("span");
            icedSpan.className = "flag-iced";
            icedSpan.textContent = "Iced";
            flagsDiv.appendChild(icedSpan);
          }

          if (order.syrup_id) {
            const syrupSpan = document.createElement("span");
            syrupSpan.className = "flag-syrup";
            syrupSpan.textContent = "Syrup";
            flagsDiv.appendChild(syrupSpan);
          }

          const notesText = document.createElement("div");
          notesText.className = "order-notes";
          notesText.textContent = order.notes || "";

          metaDiv.appendChild(flagsDiv);
          metaDiv.appendChild(notesText);

          notesTd.appendChild(metaDiv);
          tr.appendChild(notesTd);

          const statusTd = document.createElement("td");
          const statusBadge = document.createElement("span");
          statusBadge.className = "badge-default";
          statusBadge.textContent =
            order.status === "completed" ? "Completed" : "Pending";
          statusTd.appendChild(statusBadge);
          tr.appendChild(statusTd);

          const actionsTd = document.createElement("td");

          if (order.status !== "completed") {
            const completeBtn = document.createElement("button");
            completeBtn.type = "button";
            completeBtn.className = "btn-secondary btn-small";
            completeBtn.textContent = "Mark done";
            completeBtn.addEventListener("click", () =>
              updateOrderStatus(order.id, "completed")
            );
            actionsTd.appendChild(completeBtn);
          }

          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.className = "btn-danger btn-small";
          deleteBtn.textContent = "Delete";
          deleteBtn.addEventListener("click", () =>
            deleteOrder(order.id)
          );
          actionsTd.appendChild(deleteBtn);

          tr.appendChild(actionsTd);

          tbody.appendChild(tr);
        });

        ordersTableContainer.appendChild(table);
      }

      async function updateOrderStatus(orderId, status) {
        setAppStatus(ordersTableContainer, "Updating order...");

        const { error } = await supabase
          .from("orders")
          .update({ status })
          .eq("id", orderId);

        if (error) {
          console.error(error);
          setAppStatus(
            ordersTableContainer,
            "Failed to update order.",
            true
          );
          return;
        }

        setAppStatus(ordersTableContainer, "Updated order.");
        await refreshOrders();
      }

      async function deleteOrder(orderId) {
        if (!confirm("Delete this order?")) return;

        setAppStatus(ordersTableContainer, "Deleting order...");

        const { error } = await supabase
          .from("orders")
          .delete()
          .eq("id", orderId);

        if (error) {
          console.error(error);
          setAppStatus(
            ordersTableContainer,
            "Failed to delete order.",
            true
          );
          return;
        }

        setAppStatus(ordersTableContainer, "Deleted order.");
        await refreshOrders();
      }

      async function populateOrderDropdowns() {
        const { data: menus, error: menusError } = await supabase
          .from("menus")
          .select("*")
          .order("name", { ascending: true });
        if (menusError) {
          console.error(menusError);
        }

        const { data: drinks, error: drinksError } = await supabase
          .from("drinks")
          .select("*")
          .order("name", { ascending: true });
        if (drinksError) {
          console.error(drinksError);
        }

        const { data: syrups, error: syrupsError } = await supabase
          .from("syrups")
          .select("*")
          .order("name", { ascending: true });
        if (syrupsError) {
          console.error(syrupsError);
        }

        manualOrderMenuSelect.innerHTML = "";
        ordersMenuFilter.innerHTML =
          '<option value="">All menus</option>';

        (menus || []).forEach((menu) => {
          const opt1 = document.createElement("option");
          opt1.value = menu.id;
          opt1.textContent = menu.name || "(no name)";
          manualOrderMenuSelect.appendChild(opt1);

          const opt2 = document.createElement("option");
          opt2.value = menu.id;
          opt2.textContent = menu.name || "(no name)";
          ordersMenuFilter.appendChild(opt2);
        });

        manualOrderDrinkSelect.innerHTML = "";
        (drinks || []).forEach((drink) => {
          const opt = document.createElement("option");
          opt.value = drink.id;
          opt.textContent = drink.name || "(no name)";
          manualOrderDrinkSelect.appendChild(opt);
        });

        manualOrderSyrupSelect.innerHTML = "";
        const noneOpt = document.createElement("option");
        noneOpt.value = "";
        noneOpt.textContent = "None";
        manualOrderSyrupSelect.appendChild(noneOpt);

        (syrups || []).forEach((syrup) => {
          const opt = document.createElement("option");
          opt.value = syrup.id;
          opt.textContent = syrup.name || "(no name)";
          manualOrderSyrupSelect.appendChild(opt);
        });
      }

      manualOrderForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        manualOrderStatusEl.textContent = "Saving order...";
        manualOrderStatusEl.className = "status-message";

        const payload = {
          name: manualOrderNameInput.value.trim() || null,
          drink_id: manualOrderDrinkSelect.value || null,
          menu_id: manualOrderMenuSelect.value || null,
          is_iced: manualOrderIcedCheckbox.checked,
          syrup_id: manualOrderSyrupSelect.value || null,
          notes: manualOrderNotesTextarea.value.trim() || null,
          status: "pending"
        };

        try {
          const { error } = await supabase
            .from("orders")
            .insert(payload);

          if (error) {
            console.error(error);
            manualOrderStatusEl.textContent =
              "Failed to save manual order.";
            manualOrderStatusEl.classList.add("status-error");
            return;
          }

          manualOrderStatusEl.textContent = "Order added.";
          manualOrderStatusEl.classList.add("status-success");

          manualOrderForm.reset();
          await refreshOrders();
        } catch (err) {
          console.error(err);
          manualOrderStatusEl.textContent = "Unexpected error.";
          manualOrderStatusEl.classList.add("status-error");
        }
      });

      ordersMenuFilter.addEventListener("change", refreshOrders);
      ordersStatusFilter.addEventListener("change", refreshOrders);

      createMenuBtn.addEventListener("click", () =>
        renderMenuEditForm({
          id: null,
          name: "",
          is_active: false
        })
      );

      refreshMenusBtn.addEventListener("click", refreshMenus);

      createDrinkBtn.addEventListener("click", () =>
        renderDrinkEditForm({
          id: null,
          name: "",
          category_id: "",
          description: ""
        })
      );

      refreshDrinksBtn.addEventListener("click", refreshDrinks);

      createCategoryBtn.addEventListener("click", () =>
        renderCategoryEditForm({
          id: null,
          name: "",
          sort_order: null
        })
      );

      refreshCategoriesBtn.addEventListener(
        "click",
        refreshCategories
      );

      createSyrupBtn.addEventListener("click", () =>
        renderSyrupEditForm({
          id: null,
          name: "",
          flavour: ""
        })
      );
      refreshSyrupsBtn.addEventListener("click", refreshSyrups);

      supabase.auth.getUser().then(({ data }) => {
        if (data && data.user) {
          authSection.style.display = "none";
          appSection.style.display = "block";
          refreshAllData();
        }
      });
    </script>
  </body>
</html>
